<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>
        Bitcoin payment channel demo
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="Bitcoin payment channel demo">
    <meta name="author" content="Rune K. Svendsen">

    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">-->
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

    <link href="css/bitcoinaddress.css" rel="stylesheet">


    <style>

        body {
            font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
        }
        h2 {
          font-size: 35px;
          padding-top: 0px;
          padding-bottom: 0px
        }
        code {
            font-family: monospace;;
        }

        .no-margin {
          margin-top: 0px;
          padding: 0px;

        }

        .jumbotron {
            padding-top: 15px;
            padding-left: 40px;
            padding-right: 40px;
        }

        .jumbotron p {
            font-weight: 200;
        }

        #mainheader {
            padding-bottom: 35px;
            text-align: center;
        }

        /* transparent columns */
        [class*="col-"]{
            background-color: rgba(0, 0, 0, 0.0);
            border-color: rgba(0,0,0,0);
        }

        .well p {
            margin-bottom: 5px;
            font-size: 17px;
            font-weight: 300;
        }

        .row .step > .well {
            margin-top: 0px;
            margin-bottom: 0px;
            height: 100%;
        }


        .row .step > .well > div:not(.progress), p {
          padding-top: 5px;
          padding-bottom: 5px;
          margin-bottom: 0px;
        }

        .inputwrap {
          padding-top: 0px;
        }

        .blockUI.blockOverlay { opacity: 0.1; }

        #testMode
        {
            /* opacity: 0;  initial state */
            position:fixed;
            padding:0;
            margin:0;

            top:0;
            left:0;

            width: 100%;
            height: 100%;
            background:rgba(255,0,0,0.2);
            /* click through */
            pointer-events: none;
        }

        .morestuff {
          background: rgb(170,185,213);
        }


    </style>
</head>

<body>

<div class="jumbotron">
      <h1 id="mainheader">
          Bitcoin payment channel demo
      </h1>
    <p>
        Bitcoin payment channels allow two parties to instantly send bitcoins
        to each other – paying the Bitcoin transaction fee only once, when the channel
        is closed. The protocol used in this example enables a client to send value
        to a server, but not the other way around. The server is the merchant, and the
        client is the customer. That being said, the client can choose to run its own payment
        server, using the same software the server uses, only with the itself in the server role.
    </p>
    <p>
        Before starting off, I should inform you that this example works both
        with regular bitcoins and on Bitcoin's testnet network (with test bitcoins).
        If you have no idea what Bitcoin's testnet network is, and want to open a payment channel with
        my server anyway and send me money, I figure I shouldn't try to to stop you.
        But if you'd like to test it out without going broke, you can enable testnet
        with this toggle.
    </p>
    <p style="text-align: center;">
        <input id="enableTestnet" type="checkbox"
               data-toggle="toggle"
               data-size="large"
               data-on="Testnet" data-onstyle="danger"
               data-off="Bitcoin" data-offstyle="success"
               style="display: none;">
     </p>
</div>
<div class="container-fluid">
    <div class="row ">
        <div class="col-xs-12 col-sm-12 col-md-6 step">
            <div class="well" id="genKeyStep">
              <div>
                <h2>Preparation</h2>
              </div>
              <p>
                  To open a new payment channel, first generate a private key. This private
                  key is used to sign payments made over the channel. It's also used to sign
                  the refund transaction. So if you don't want to risk losing the funds sent
                  to the channel, you should back up this key.
              </p>
              <p class="inputwrap">
                <div class="well">
                  <p>
                    <div class="form-group">
                        <label>
                            Private key
                        </label>
                        <input disabled id="privKey" type="text" class="form-control">
                               <!--placeholder="Click the Generate button">-->
                    </div>
                    <a class="btn btn-primary" id="genPrivKey">Generate</a>
                  </p>
                </div>
              </p>
              <p>Test text. 1 2 3, banana shrimp hello. Hey.</p>
            </div>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 step">
            <div class="well" id="fundingStep">
                <h2>
                    1. Get funding address
                </h2>
                <p>
                    If you wish, adjust the channel expiration date. You can test the refund
                    feature immediately if you specify a date in the past (normally this
                    wouldn't be allowed). Now click <i>Get funding address</i>.
                </p>
                <p class="inputwrap">
                  <div class="well">
                    <p>
                        <div class="form-group">
                            <label>
                                Channel expiration date
                            </label>
                            <input id="expDatePicker" type="datetime-local" class="form-control">
                        </div>
                    </p>
                    <p>
                        <a class="btn btn-primary" id="getServerInfo">
                            Get funding address
                        </a>
                        <a disabled class="btn btn-warning pull-right" id="debug">Fake-fund</a>
                    </p>
                  </div>
                </p>
                <p>
                  <div class="alert alert-info fade in" id="addressAlert">
                      <span id="fundingRes">
                        <i>No information received from server yet</i>
                      </span>
                  </div>
                </p>
                <p>
                    After clicking the button, the channel funding address – as well as the
                    price the server charges to open the payment channel (the <i>open price</i>) – are
                    displayed above. Pay to the funding address to proceed to the next step.
                    The amount paid to the address should be the <i>open price</i>, plus the amount
                    you want available to send in the channel, after it has been opened.
                </p>

            </div>
        </div>
    </div>

    <div class="row ">
        <div class="col-xs-12 col-sm-12 col-md-6 step">
            <div class="well" id="openStep">
                <h2>
                    2. Open channel
                </h2>
                <p>
                    You can now choose to generate a refund transaction before opening the
                    channel. Enter a custom change address if you want – the
                    one displayed has been derived from the generated private key.
                </p>
                <p class="inputwrap">
                  <div class="well">
                    <p>
                      <div class="form-group">
                          <label>
                              Refund/change address
                          </label>
                          <input type="string" class="form-control pull-left" placeholder="Refund/change address"
                                 name="" id="refundAddress">
                      </div>
                      <a class="btn btn-primary" id="getRefundTx">Save refund transaction</a>
                    </p>
                  </div>
                </p>
                <p>
                    The refund transaction returns all value to the change address,
                    but it's not valid until the specified expiration date. This is
                    also the address that the remaining, unspent value in the payment
                    channel is sent to when the channel is closed. As part of opening
                    the channel, the first payment – paying the specified open price –
                    is sent to the server. Click the button to open the channel.
                </p>
                <p>
                    <a class="btn btn-success" id="openChannel">
                      Open channel
                      <i id="openSpinner" class="fa fa-circle-o-notch fa-spin fa-fw fade in" style="display: none;"></i>

                    </a>
                </p>
            </div>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 step">
            <div class="well" id="payStep">
                <h2>
                    3. Pay
                </h2>
                <p>
                    Make as many payments as you want. Click the
                    <i>Close</i>
                    button to close the payment channel, thereby sending the remaining channel
                    value to the change address.
                </p>
                <p class="inputwrap">
                  <div class="well">
                    <p>
                      <div class="form-group">
                          <label>
                              Amount (satoshis)
                          </label>
                          <input type="number" class="form-control pull-left" placeholder="Payment amount (satoshis)"
                                 name="" id="paymentAmount">
                      </div>
                      <a class="btn btn-success" id="makePayment">Pay!</a>
                    </p>
                  </div>
                </p>
                <div class="alert alert-success fade in" id="paymentAlert" style="display: none;"></div>
                <p>
                </p>
                <p>
                </p>
                <div class="progress" id="progress">
                    <div class="progress-bar progress-bar-success" style="width: 0%">
                    </div>
                </div>
                <p>
                </p>
                <p>
                    <a class="btn btn-danger" id="closeChannel">Close</a>
                </p>
            </div>
        </div>
    </div>


    <div id="bitcoin-address-template" class="bitcoin-address-container" hidden>

        <div>
            <span class="bitcoin-address"></span>
        </div>

        <a href="#" class="bitcoin-address-action bitcoin-address-action-send">
            <i class="fa fa-btc"></i>
            Pay from wallet
        </a>

        <a href="#" class="bitcoin-address-action bitcoin-address-action-copy">
            <i class="fa fa-copy"></i>
            Copy
        </a>

        <a href="#" class="bitcoin-address-action bitcoin-address-action-qr">
            <i class="fa fa-qrcode"></i>
            QR code
        </a>

        <div class="bitcoin-action-hint bitcoin-action-hint-send">
        </div>

        <div class="bitcoin-action-hint bitcoin-action-hint-copy">
            Press CTRL + C or &#x2318; + C to copy the Bitcoin address.
        </div>

        <div class="bitcoin-action-hint bitcoin-action-hint-qr">
            <div class="bitcoin-address-qr-container">
                <!-- Filled in by JS on action click -->
            </div>
        </div>

    </div>

    <!--<input id="serverAddress" style="display: none;" type="text" value="http://localhost:8000">-->


  <br><br><br><br><br><br><br>
  <br><br><br><br><br><br><br>
  <br><br><br>
  <div class="jumbotron morestuff">
        <h1 id="mainheader">
            More stuff
        </h1>
      <div class="row">

        <div class="col-xs-12 col-md-6">

          <div class="row">
            <div class="col-xs-12">
              <div class="well">
                <h2>Client library</h2>
                <p>
                  The source code for this demo, including the Javascript client library,
                  will be available soon in an easy-to-digest format. Until then,
                  go <a href="https://github.com/runeksvendsen/runeksvendsen.github.io">here</a>
                  for the raw code.
                </p>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-12">
              <div class="well">
                <h2>Client library</h2>
                <p>
                  The source code for this demo, including the Javascript client library,
                  will be available soon in an easy-to-digest format. Until then,
                  go <a href="https://github.com/runeksvendsen/runeksvendsen.github.io">here</a>
                  for the raw code.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-12 col-md-6">
          <div class="well">
            <h2>
              Payment channel server
            </h2>
            <p>
              The payment channel server (written in Haskell) used in this demo is
              open source software, available
              <a href="https://github.com/runeksvendsen/restful-payment-channel-server">here</a>.
              Binaries are available in the <code>bin/</code> directory,
              so you can run this demo against your own server. Just fill out your
              running server's address below and it should work. Note that the software
              is highly experimental. Use at your own risk, and please report any
              bugs you may come across.
            </p>
            <p>
              <div class="form-group">
                  <label>
                      Server address
                  </label>
                  <input id="serverAddress" value="https://paychan.runeks.me"
                    type="string"
                    class="form-control pull-left" placeholder="Server address">
              </div>
            </p>
            <br>
          </div>
        </div>
      </div>
  </div>

</div>


<div id="testMode" style="display: none"></div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

<script >

    $(function() {
        window.config = { useTestnet : false };
        $('#enableTestnet').change(function() {
            window.config.useTestnet = $(this).prop('checked');

            if (window.config.useTestnet === true) {
              $('#testMode').fadeIn();
            } else {
              $('#testMode').fadeOut();
            }
        })
        $('#enableTestnet').bootstrapToggle().show().prop('checked', true).change();
    });

</script>

<script type="text/javascript" src="ui-browserify.js"></script>
</body>

</html>
